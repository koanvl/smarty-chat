<%= turbo_stream_from "dialog_#{@dialog.id}" if @dialog %>

<div class="min-h-screen bg-gray-50 flex">
  <%= render "sidebar" %>

  <main class="flex-1 flex flex-col">
    <% if @dialog %>
      <header class="py-4 px-6 bg-white border-b">
        <h1 class="text-2xl font-semibold text-gray-800">Chat</h1>
      </header>

      <div class="flex-1 bg-white">
        <div id="messages" class="h-[calc(100vh-240px)] overflow-y-auto p-6 space-y-4">
          <%= render @messages %>
        </div>
      </div>

      <div class="bg-white border-t p-4">
        <%= form_with model: Message.new,
                      url: dialog_messages_path(@dialog),
                      class: "flex items-end gap-2",
                      data: {
                        controller: "reset-form",
                        action: "turbo:submit-end->reset-form#reset"
                      } do |f| %>
          <div class="flex-1">
            <%= f.text_area :content,
                           rows: 1,
                           class: "w-full resize-none rounded-xl border-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200 py-3 px-4",
                           placeholder: "Type your message..." %>
          </div>
          <%= f.submit "Send",
                      class: "rounded-xl bg-[#2563eb] px-4 py-3 text-white font-medium hover:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-200 transition duration-200" %>
        <% end %>
      </div>
    <% else %>
      <div class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <h2 class="text-xl font-semibold text-gray-800 mb-2">Start a new chat</h2>
          <p class="text-gray-600">Type your first message to create a dialog</p>
          <%= form_with scope: :message,
                        url: create_message_with_dialog_path,
                        class: "mt-4 flex flex-col items-center gap-2",
                        data: {
                          controller: "reset-form",
                          action: "turbo:submit-end->reset-form#reset"
                        } do |f| %>
            <%= f.text_area :content,
                           rows: 3,
                           class: "w-96 resize-none rounded-xl border-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-200 transition duration-200 py-3 px-4",
                           placeholder: "Type your message..." %>
            <%= f.submit "Send",
                        class: "w-96 rounded-xl bg-[#2563eb] px-4 py-3 text-white font-medium hover:bg-blue-700 focus:outline-none focus:ring focus:ring-blue-200 transition duration-200" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </main>
</div>